<h2>Conversation</h2>

<ul>
    {% for message in messages %}
        <li>
            <strong>{{ message.sender.username }}</strong>: {{ message.content }} <br>
            <small>{{ message.timestamp }}</small>

            {% if message.replies.all %}
                <ul>
                {% for reply in message.replies.all %}
                    <li>
                        <strong>{{ reply.sender.username }}</strong>: {{ reply.content }} <br>
                        <small>{{ reply.timestamp }}</small>
                        {% with replies=get_replies(reply) %}
                            {% include "messaging/reply_thread.html" with replies=replies %}
                        {% endwith %}
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
        </li>
    {% endfor %}
</ul>